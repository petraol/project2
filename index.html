<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="//code.jquery.com/jquery-2.0.0.js"></script>
	<title>Assignment 2</title>
    <style>
        .legend {
            font-size: 12px;                                          
        }                                                           
        rect {                                                      
            stroke-width: 2;                                          
        } 
        #title {
            font-size: 30px;  
            text-align: center;
        }
        
        .bar { 
            fill: #ffccff; 
        }
        
        
        .tooltip {
            background: #eee;
            box-shadow: 0 0 5px #999999;
            color: #333;
            font-size: 12px;
            left: 130px;
            padding: 10px;
            position: absolute;
            text-align: center;
            top: 95px;
            width: 80px;
            z-index: 10;
            display: block;
            opacity: 0;
        }
        
        #map {
          background-color: #fff;
        }
        
        .background {
          fill: none;
          pointer-events: all;
        }
        #countries, #states {
          fill: grey;
          stroke: #fff;
          stroke-linejoin: round;
          stroke-linecap: round;
        }
        #countries .active, #states .active {
          fill: #89a;
        }
        #cities {
          stroke-width: 0;
        }
        .city {
          fill: #345;
          stroke: #fff;
        }
        pre.prettyprint {
          border: 1px solid #ccc;
          margin-bottom: 0;
          padding: 9.5px;
        }
        li {
            /*display: inline;*/
        }
                    
    </style>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-2.0.0.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- Countries -->
    <script src="//d3js.org/topojson.v1.min.js"></script>
</head>
    

    
<body>
    <div id="header" style="display:block"><h1 style="text-align: center">How happy are you?</h1></div>
    <div class ="col-sm-12" style="text-align: middle">
        <p style="display: inline">Select wave: </p>
        <button type="button" class="btn btn-primary" onclick="changeWave('1995-1999')">1995-1999</button>
        <button type="button" class="btn btn-primary" onclick="changeWave('2000-2004')">2000-2004</button>
        <button type="button" class="btn btn-primary" onclick="changeWave('2005-2009')">2005-2009</button>
        <button type="button" class="btn btn-primary" onclick="changeWave('2010-2014')">2010-2014</button>
        <div id="backButton" style="display: none"><button type="button" class="btn btn-danger" onclick="gotoMap()">Go to map</button></div>
    </div>
    <div class ="col-sm-12" id="year" style="display: block"></div>
    <div id="squares" style="display: block" class="col-sm-2">
        <h4>Countries happiness based on percentage</h4>
        <ul type="square">
        <li style="color: #800040">Very Happy</li>
        <li style="color: #e60073">Quite happy</li>
        <li style="color: #ff4da6">Not very happy </li>
        <li style="color: #ffb3d9">Not at all happy</li>
        <li style="color: #ffe6e6">Other</li>
        <li style="color: grey">Data not available</li>
        </ul>
    </div>
    <div id="map" class="col-sm-10"></div>
    <div id="charts" style="visibility: hidden">
        <div class="row">
            <div class ="col-sm-12" id="title"></div>
        </div>
        <div class="row">
                <div class="col-sm-6" id="donut-charts">
                <div class ="col-sm-6" id="chartFamily"></div>
                <div class ="col-sm-6" id="chartFriends"></div>
                <div class ="col-sm-6" id="chartLeisureTime"></div>
                <div class ="col-sm-6" id="chartPolitics"></div>  
                <div class ="col-sm-6" id="chartReligion"></div>
                <div class ="col-sm-6" id="chartWork"></div>
            </div>
            <div class="col-sm-6" id="linear">
                <div class="col-sm-12" id="barHappiness"></div>
                <div class="col-sm-12" id="barSatisfaction"></div>
            </div>
        </div>
        
    </div>
    <script>
        
        var selected_country = "Argentina";
        var selected_wave = "1995-1999";
        var status = "1";
        updateData();
        updateMap();    
        
        
    function updateMap() {
        console.log("ritar karta")
    var m_width = $("#map").width(),
        width = 1500,
        height = 750,
        country,
        state;

    var projection = d3.geoMercator()
        .scale(150)
        .translate([width / 2, height / 1.5]);

    var path = d3.geoPath()
        .projection(projection);

    var svg = d3.select("#map").append("svg")
        .attr("preserveAspectRatio", "xMidYMid")
        .attr("class", "takemeaway")
        .attr("viewBox", "0 0 " + width + " " + height)
        .attr("width", m_width)
        .attr("height", m_width * height / width);

    svg.append("rect")
        .attr("class", "background")
        .attr("width", width)
        .attr("height", height)
        .on("click", country_clicked);

    var g = svg.append("g");

    var countryData = [
        ["Argentina", "Australia", "Chile", "China", "Taiwan", "Colombia", "Georgia", "India", "Japan", "South Korea", "Mexico", "Moldova", "New Zealand", "Nigeria", "Pakistan", "Peru", "Philippines", "Poland", "Romania", "Russia", "Slovenia", "South Africa", "Spain", "Sweden", "Turkey", "Ukraine", "United States", "Uruguay", "Serbia"],
        ["Argentina", "Chile", "China", "India", "Japan", "South Korea", "Mexico", "Moldova", "Nigeria", "Pakistan", "Peru", "Philippines", "South Africa", "Spain", "Sweden", "Turkey", "Egypt", "United States", "Serbia"],
        ["Argentina", "Australia", "Chile", "China", "Taiwan", "Colombia", "Georgia", "India", "Japan", "South Korea", "Mexico", "Moldova", "New Zealand", "Peru", "Poland", "Romania", "Russia", "Slovenia", "South Africa", "Spain", "Sweden", "Turkey", "Ukraine", "Egypt", "United States", "Uruguay", "Serbia"],
        ["Argentina", "Australia", "Chile", "China", "Taiwan", "Colombia", "Georgia", "India", "Japan", "South Korea", "Mexico", "New Zealand", "Nigeria", "Pakistan", "Peru", "Philippines", "Poland", "Romania", "Russia", "Slovenia", "South Africa", "Spain", "Sweden",	"Turkey", "Ukraine", "Egypt", "United States", "Uruguay"]
        ];    
        
    var countryHappiness = [
        [{country:"Argentina", happy: "Quite happy"}, {country:"Australia", happy: "Quite happy"}, {country: "Chile", happy: "Quite happy"}, {country: "China", happy: "Quite happy"}, {country: "Taiwan", happy: "Quite happy"}, {country:"Colombia", happy: "Very happy"}, {country:"Georgia", happy: "Quite happy"}, {country:"India", happy: "Quite happy"}, {country:"Japan", happy: "Quite happy"}, {country:"South Korea", happy: "Quite happy"}, {country:"Mexico", happy: "Quite happy"}, {country:"Moldova", happy: "Not very happy"}, {country:"New Zealand", happy: "Quite happy"}, {country:"Nigeria", happy: "Very happy"}, {country:"Pakistan", happy: "Quite happy"}, {country:"Peru", happy: "Not very happy"}, {country:"Philippines", happy: "Quite happy"}, {country:"Poland", happy: "Quite happy"}, {country:"Romania", happy: "Quite happy"}, {country:"Russia", happy: "Quite happy"}, {country:"Slovenia", happy: "Quite happy"}, {country:"South Africa", happy: "Quite happy"}, {country:"Spain", happy: "Quite happy"}, {country:"Sweden", happy: "Quite happy"}, {country:"Turkey", happy: "Very happy"}, {country:"Ukraine", happy: "Quite happy/Not very happy"}, {country:"United States", happy: "Quite happy"}, {country:"Uruguay", happy: "Quite happy"}, {country:"Serbia", happy: "Quite happy"}],
        
        [{country:"Argentina", happy: "Quite happy"}, {country: "Chile", happy: "Quite happy"}, {country: "China", happy: "Quite happy"},{country:"India", happy: "Quite happy"}, {country:"Japan", happy: "Quite happy"}, {country:"South Korea", happy: "Quite happy"}, {country:"Mexico", happy: "Very happy"}, {country:"Moldova", happy: "Not very happy"}, {country:"Nigeria", happy: "Very happy"}, {country:"Pakistan", happy: "Quite happy"}, {country:"Peru", happy: "Quite happy"}, {country:"Philippines", happy: "Quite happy"}, {country:"South Africa", happy: "Quite happy"}, {country:"Spain", happy: "Quite happy"}, {country:"Sweden", happy: "Quite happy"}, {country:"Turkey", happy: "Quite happy"}, {country: "Egypt", happy: "Quite happy"}, {country:"United States", happy: "Quite happy"}, {country:"Serbia", happy: "Quite happy"}],
        
        [{country:"Argentina", happy: "Quite happy"}, {country:"Australia", happy: "Quite happy"}, {country: "Chile", happy: "Quite happy"}, {country: "China", happy: "Quite happy"}, {country: "Taiwan", happy: "Quite happy"}, {country:"Colombia", happy: "Very happy"}, {country:"Georgia", happy: "Quite happy"}, {country:"India", happy: "Quite happy"}, {country:"Japan", happy: "Quite happy"}, {country:"South Korea", happy: "Quite happy"}, {country:"Mexico", happy: "Very happy"}, {country:"Moldova", happy: "Quite happy"}, {country:"New Zealand", happy: "Quite happy"}, {country:"Peru", happy: "Quite happy"}, {country:"Poland", happy: "Quite happy"}, {country:"Romania", happy: "Quite happy"}, {country:"Russia", happy: "Quite happy"}, {country:"Slovenia", happy: "Quite happy"}, {country:"South Africa", happy: "Very happy"}, {country:"Spain", happy: "Quite happy"}, {country:"Sweden", happy: "Quite happy"}, {country:"Turkey", happy:"Quite happy"}, {country:"Ukraine", happy: "Quite happy"}, {country: "Egypt", happy:"Quite happy" }, {country:"United States", happy: "Quite happy"}, {country:"Uruguay", happy: "Quite happy"}, {country:"Serbia", happy: "Quite happy"}],
        
        [{country:"Argentina", happy: "Quite happy"}, {country:"Australia", happy: "Quite happy"}, {country: "Chile", happy: "Quite happy"}, {country: "China", happy: "Quite happy"}, {country: "Taiwan", happy: "Quite happy"}, {country:"Colombia", happy: "Very happy"}, {country:"Georgia", happy: "Quite happy"}, {country:"India", happy: "Quite happy"}, {country:"Japan", happy: "Quite happy"}, {country:"South Korea", happy: "Quite happy"}, {country:"Mexico", happy: "Very happy"}, {country:"New Zealand", happy: "Quite happy"}, {country:"Pakistan", happy: "Very happy"}, {country:"Peru", happy: "Quite happy"}, {country:"Philippines", happy: "Very happy"}, {country:"Poland", happy: "Quite happy"}, {country:"Romania", happy: "Quite happy"}, {country:"Russia", happy: "Quite happy"}, {country:"Slovenia", happy: "Quite happy"}, {country:"South Africa", happy: "Very happy"}, {country:"Spain", happy: "Quite happy"}, {country:"Sweden", happy: "Quite happy"}, {country:"Turkey", happy: "Quite happy"}, {country:"Ukraine", happy: "Quite happy"},  {country:"Egypt", happy: "Not at all happy"},{country:"United States", happy: "Quite happy"}, {country:"Uruguay", happy: "Quite happy"}]
        ];     
        
        function colorMe(wave, country) {
            var color = "";
            var happiness = "";
            temporary_countryHappiness = countryHappiness[wave];
            for (i=0; i<temporary_countryHappiness.length; i++) {
                if (temporary_countryHappiness[i].country == country) {
                    happiness = temporary_countryHappiness[i].happy;
                }
            }
            if (happiness == "Very happy") {
                color = "#800040";
                return color;
            }
            else if (happiness == "Quite happy") {
                color = "#e60073";
                return color;
            }
            else if (happiness == "Not very happy") {
                color = "#ff4da6";
                return color;
            }
            else if (happiness == "Not at all happy") {
                color = " #ffb3d9";
                return color;
            }
            else {
                color ="#ffe6e6";
                return color;
            }
        }
        
        d3.json("countries.topo.json", function(error, us) {
                g.append("g")
                    .attr("id", "countries")
                    .selectAll("path")
                    .data(topojson.feature(us, us.objects.countries).features)
                    .enter()
                    .append("path")
                    .attr("id", function(d) { return d.id; })
                    .attr("style", function(d){ 
                        if (selected_wave == "1995-1999" && countryData[0].includes(d.properties.name) == true) {
                            var color = colorMe(0, d.properties.name);
                            return "fill: " + color;
                        }
                        if(selected_wave == "2000-2004" &&countryData[1].includes(d.properties.name) == true){
                            var color = colorMe(0, d.properties.name);
                            return "fill: " + color;
                        }
                        if(selected_wave == "2005-2009" &&countryData[2].includes(d.properties.name) == true){
                            var color = colorMe(0, d.properties.name);
                            return "fill: " + color;
                        }
                        if(selected_wave == "2010-2014" &&countryData[3].includes(d.properties.name) == true){
                            var color = colorMe(0, d.properties.name);
                            return "fill: " + color;;
                        }
                    })
            .attr("d", path)
            .on("click", country_clicked);
            //.on("mouseover", handleMouseOver)
            //.on("mouseout", handleMouseOut);
        });
    }

        
        function country_clicked(d) {
            status = "2";
            selected_country = d.properties.name
            updateData();
            document.getElementById("charts").style = 'visible';
            document.getElementById("backButton").style = "display: block";
            d3.select(".takemeaway").remove();
            document.getElementById("squares").style = "display: none";
            document.getElementById("header").style = "display: none";
            document.getElementById("year").style = "display: none";
        }

        function changeWave(wave) {
            selected_wave = wave;
            console.log("i change wave");
            d3.select(".takemeaway").remove();
            console.log("status:", status)
            if (status == "1") {
                console.log("jag uppdaterar kartan")
                updateMap();
                updateData();
            }
            else {
                updateData();
            }
        }
        
        function gotoMap() {
            console.log("gotomap")
            status = "1";
            updateMap();
            document.getElementById("backButton").style = "display: none";
            document.getElementById("squares").style = "display: block";
            document.getElementById("header").style = "display: block";
            document.getElementById("year").style = "display: block";
            d3.select("#charts").attr("style", "visibility: hidden");
        }
        
        var element = document.getElementById("title");
            element.innerHTML = selected_country + " " + selected_wave;
        
        var element2 = document.getElementById("year");
            element2.innerHTML = "<h3 style='text-align:center'>The world " + selected_wave + "</h3>";
        
        
        function updateData() {    
            
            var element = document.getElementById("title");
            element.innerHTML = selected_country + " " + selected_wave;
            
            var element2 = document.getElementById("year");
            element2.innerHTML = "<h3 style='text-align:center'>The world " + selected_wave + "</h3>";
            
            document.getElementById("chartFamily").innerHTML = "";
            document.getElementById("chartFriends").innerHTML = "";
            document.getElementById("chartLeisureTime").innerHTML = "";
            document.getElementById("chartPolitics").innerHTML = "";
            document.getElementById("chartReligion").innerHTML = "";
            document.getElementById("chartWork").innerHTML = "";
            document.getElementById("barHappiness").innerHTML = "";
            document.getElementById("barSatisfaction").innerHTML = "";
            
        // Feeling of happines data extract and bar chart
        // get the data
            d3.csv(selected_wave + "/Feeling_of_happiness.csv", function(d) {
                // strip out relevant fields
                var point = {};
                point.country = d.Country;
                point.very_happy = +d["Very happy"];
                point.quite_happy = Number(+d["Quite happy"]);
                point.not_very_happy = Number(+d["Not very happy"]);
                point.not_happy = Number(+d["Not at all happy"]);
                point.inapplicable = Number(d.Inapplicable);
                point.no_answer = Number(d.NA);
                point.dont_know = Number(d.DK);
                return point;
            }, function(error, data) {
            //d3.csv("sales.csv", function(error, data) {
                // set the dimensions and margins of the graph
                var margin = {top: 20, right: 20, bottom: 30, left: 40},
                    width = 600 - margin.left - margin.right,
                    height = 300 - margin.top - margin.bottom;

                // set the ranges
                var x = d3.scaleBand()
                          .range([0, width])
                          .padding(0.1);
                var y = d3.scaleLinear()
                          .range([height, 0]);

                // append the svg object to the body of the page
                // append a 'group' element to 'svg'
                // moves the 'group' element to the top left margin
                                                                                          //ANVÄND DENNA FLR ATT TA BORT D#:JS OBKEKT
                
                var svg = d3.select("#barHappiness").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", 
                          "translate(" + margin.left + "," + margin.top + ")");
                
                var tooltip = d3.select("#barHappiness").append("div").attr("class", "tooltip");
                
                tooltip.append('div')
                .attr('class', 'label');

                tooltip.append('div')
                .attr('class', 'count');

                var noCountry = [];
                //Sorting out the data to only display the country selected
                for (i=0; i<data.length; i++) {
                    if (data[i].country == selected_country) {
                        data = data[i];
                        noCountry = [];
                    }
                    else {
                        noCountry.push(data[i].country)
                    }
                        //d3.select("#barHappiness").html("Data not available")
                }
                
                if (noCountry.length == data.length) {
                    d3.select("#barHappiness").html("Data not available")
                }
                else {
                    if (data.inapplicable == undefined) {
                    var dataset = [
                        {label: 'Very happy', count: data.very_happy.toString()},
                        {label: 'Quite happy', count: data.quite_happy.toString()},
                        {label: 'Not very happy', count: data.not_very_happy.toString()},
                        {label: 'Not happy', count: data.not_happy.toString()},
                        {label: 'Dont know', count: data.dont_know.toString()},
                        {label: 'No answer', count: data.no_answer.toString()}
                    ];
                }
                else {
                    var dataset = [
                        {label: 'Very happy', count: data.very_happy.toString()},
                        {label: 'Quite happy', count: data.quite_happy.toString()},
                        {label: 'Not very happy', count: data.not_very_happy.toString()},
                        {label: 'Not happy', count: data.not_happy.toString()},
                        {label: 'Inapplicable', count: data.inapplicable.toString()},
                        {label: 'Dont know', count: data.dont_know.toString()},
                        {label: 'No answer', count: data.no_answer.toString()}
                    ];
                }



                  // format the data
                  dataset.forEach(function(d) {
                    d.count = +d.count;
                  });

                  // Scale the range of the data in the domains
                  x.domain(dataset.map(function(d) { return d.label; }));
                  y.domain([0, 100]);

                  // append the rectangles for the bar chart
                  svg.selectAll(".bar")
                      .data(dataset)
                      .enter().append("rect")
                      .attr("class", "bar")
                      .attr("x", function(d) { return x(d.label); })
                      .attr("width", x.bandwidth())
                      .attr("y", function(d) { return y(d.count); })
                      .attr("height", function(d) { return height - y(d.count); })
                      .on("mouseover", function(d){
                        tooltip.select('.count').html(d.count + '%');
                        tooltip.style('display', 'block');
                        tooltip.style('opacity',2);
                        })
                      .on("mouseout", function(d){ 
                      tooltip.style("display", "none");})
                      .on('mousemove', function(d) {                            // NEW
                      tooltip.style('top', (d3.event.pageY - 150) + 'px')          // NEW
                      .style('left', (d3.event.pageX - 720) + 'px');             // NEW
                  });

                  // add the x Axis
                  svg.append("g")
                      .attr("transform", "translate(0," + height + ")")
                      .call(d3.axisBottom(x));

                  // add the y Axis
                  svg.append("g")
                      .call(d3.axisLeft(y));

                }
                });

                


            d3.csv(selected_wave + "/Life_satisfaction.csv", function(d) {
                // strip out relevant fields
                var point = {};
                point.country = d.Country;
                point.dissatisfied = Number(d.Dissatisfied);
                point.two = Number(+d["2"]);
                point.three = Number(+d["3"]);
                point.four = Number(+d["4"]);
                point.five = Number(+d["5"]);
                point.six = Number(+d["6"]);
                point.seven = Number(+d["7"]);
                point.eight = Number(+d["8"]);
                point.nine = Number(+d["9"]);
                point.satisfied = Number(d.Satisfied);
                point.inapplicable = Number(d.Inapplicable);
                point.no_answer = Number(d.NA);
                point.dont_know = Number(d.DK);
                return point;
            }, function(error, data) {
            //d3.csv("sales.csv", function(error, data) {

                // set the dimensions and margins of the graph
                var margin = {top: 20, right: 20, bottom: 30, left: 40},
                    width = 600 - margin.left - margin.right,
                    height = 300 - margin.top - margin.bottom;

                // set the ranges
                var x = d3.scaleBand()
                          .range([0, width])
                          .padding(0.1);
                var y = d3.scaleLinear()
                          .range([height, 0]);

                // append the svg object to the body of the page
                // append a 'group' element to 'svg'
                // moves the 'group' element to the top left margin
                                                                                          //ANVÄND DENNA FLR ATT TA BORT D#:JS OBKEKT
                var svg = d3.select("#barSatisfaction").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", 
                          "translate(" + margin.left + "," + margin.top + ")");
                
                var tooltip = d3.select("#barSatisfaction").append("div").attr("class", "tooltip");
                
                tooltip.append('div')
                .attr('class', 'label');

                tooltip.append('div')
                .attr('class', 'count');

                //Sorting out the data to only display the country selected
                var noCountry = [];
                //Sorting out the data to only display the country selected
                for (i=0; i<data.length; i++) {
                    if (data[i].country == selected_country) {
                        data = data[i];
                        noCountry = [];
                    }
                    else {
                        noCountry.push(data[i].country)
                    }
                        //d3.select("#barHappiness").html("Data not available")
                }
                
                if (noCountry.length == data.length) {
                    console.log('not available')
                    d3.select("#barSatisfaction").html("Data not available")
                }
                else {

                if (data.inapplicable == undefined) {
                    var dataset = [
                        {label: 'Dissatisfied', count: data.dissatisfied.toString()},
                        {label: '2', count: data.two.toString()},
                        {label: '3', count: data.three.toString()},
                        {label: '4', count: data.four.toString()},
                        {label: '5', count: data.five.toString()},
                        {label: '6', count: data.six.toString()},
                        {label: '7', count: data.seven.toString()},
                        {label: '8', count: data.eight.toString()},
                        {label: '9', count: data.nine.toString()},
                        {label: 'Satisfied', count: data.satisfied.toString()},
                        {label: 'Dont know', count: data.dont_know.toString()},
                        {label: 'No answer', count: data.no_answer.toString()}
                    ];
                }
                else {
                    var dataset = [
                        {label: 'Dissatisfied', count: data.dissatisfied.toString()},
                        {label: '2', count: data.two.toString()},
                        {label: '3', count: data.three.toString()},
                        {label: '4', count: data.four.toString()},
                        {label: '5', count: data.five.toString()},
                        {label: '6', count: data.six.toString()},
                        {label: '7', count: data.seven.toString()},
                        {label: '8', count: data.eight.toString()},
                        {label: '9', count: data.nine.toString()},
                        {label: 'Satisfied', count: data.satisfied.toString()},
                        {label: 'Inapplicable', count: data.inapplicable.toString()},
                        {label: 'Dont know', count: data.dont_know.toString()},
                        {label: 'No answer', count: data.no_answer.toString()}
                    ];
                }

                  // format the data
                  dataset.forEach(function(d) {
                    d.count = +d.count;
                  });

                  // Scale the range of the data in the domains
                  x.domain(dataset.map(function(d) { return d.label; }));
                  y.domain([0, 100]);
 
                    
                  // append the rectangles for the bar chart
                  svg.selectAll(".bar")
                      .data(dataset)
                      .enter().append("rect")
                      .attr("class", "bar")
                      .attr("x", function(d) { return x(d.label); })
                      .attr("width", x.bandwidth())
                      .attr("y", function(d) { return y(d.count); })
                      .attr("height", function(d) { return height - y(d.count); })
                      .on("mouseover", function(d){
                        tooltip.select('.count').html(d.count + '%');
                        tooltip.style('display', 'block');
                        tooltip.style('opacity',2);
                        })
                      .on("mouseout", function(d){ 
                      tooltip.style("display", "none");})
                      .on('mousemove', function(d) {                            // NEW
                      tooltip.style('top', (d3.event.pageY - 460) + 'px')          // NEW
                      .style('left', (d3.event.pageX - 720) + 'px');             // NEW
                  });

                    
                  // add the x Axis
                  svg.append("g")
                      .attr("transform", "translate(0," + height + ")")
                      .call(d3.axisBottom(x));

                  // add the y Axis
                  svg.append("g")
                      .call(d3.axisLeft(y));
                }
                });






            // Importance in life Family
            d3.csv(selected_wave + "/Importance_in_life_Family.csv", function(d) {
                // strip out relevant fields
                var point = {};
                point.country = d.Country;
                point.very_important = +d["Very important"];
                point.rather_important = +d["Rather important"];
                point.not_very_important = +d["Not very important"];
                point.not_at_all_important = +d["Not at all important"];
                point.inapplicable = Number(d.Inapplicable);
                point.no_answer = d.NA;
                point.dont_know = d.DK;
                return point;
            }, function(error, data) {

                //Sorting out the data to only display the country selected
                var noCountry = [];
                //Sorting out the data to only display the country selected
                for (i=0; i<data.length; i++) {
                    if (data[i].country == selected_country) {
                        data = data[i];
                        noCountry = [];
                    }
                    else {
                        noCountry.push(data[i].country)
                    }
                        //d3.select("#barHappiness").html("Data not available")
                }
                
                if (noCountry.length == data.length) {
                    console.log('not available')
                    d3.select("#chartFamily").html("Data not available")
                }
                else {
                     if (data.inapplicable == undefined) {
                    var dataset = [
                        {label: 'Very important', count: data.very_important},
                        {label: 'Rather Important', count: data.rather_important},
                        {label: 'Not very important', count: data.not_very_important},
                        {label: 'Not at all important', count: data.not_at_all_important},
                        {label: 'Dont know', count: data.dont_know},
                        {label: 'No answer', count: data.no_answer}

                    ];
                }
                else {
                    var dataset = [
                        {label: 'Very important', count: data.very_important},
                        {label: 'Rather Important', count: data.rather_important},
                        {label: 'Not very important', count: data.not_very_important},
                        {label: 'Not at all important', count: data.not_at_all_important},
                        {label: 'Inapplicable', count: data.inapplicable.toString()},
                        {label: 'Dont know', count: data.dont_know},
                        {label: 'No answer', count: data.no_answer}

                    ];
                }

                var width = 400;
                var height = 200;
                var margin = {top: 10, right: 10, bottom: 10, left: 10};
                var radius = Math.min(width, height) / 2;
                var donutWidth = 50;
                var legendRectSize = 20;                                  
                var legendSpacing = 8;                                    

                var color = d3.scaleOrdinal()
                  .range(['#c2f0f0', '#99e6e6', '#5cd6d6', '#2eb8b8', '#248f8f', '#196666']);

                                                                                          //ANVÄND DENNA FLR ATT TA BORT D#:JS OBKEKT
                var svg = d3.select('#chartFamily')                                             //ÄNDRA CHART HÄR
                  .append('svg')
                  .attr('width', width)
                  .attr('height', height)
                  .append('g')
                  .attr('transform', 'translate(' + (width / 4) +
                    ',' + (height / 2) + ')');

                var arc = d3.arc()
                  .innerRadius(radius - donutWidth)
                  .outerRadius(radius);

                var pie = d3.pie()
                  .value(function(d) { return d.count; })
                  .sort(null); 
                
                var tooltip = d3.select('#chartFamily')
                .append('div')
                .attr('class', 'tooltip');


                tooltip.append('div')
                .attr('class', 'label');

                tooltip.append('div')
                .attr('class', 'count');

                
                var path = svg.selectAll('path')
                  .data(pie(dataset))
                  .enter()
                  .append('path')
                  .attr('d', arc)
                  .attr('fill', function(d) {
                    return color(d.data.label);
                  });
                
                path.on('mouseover', function(d) {
                    tooltip.select('.count').html(d.data.count + '%');

                    tooltip.style('display', 'block');
                    tooltip.style('opacity',2);
                });
                
                path.on('mouseout', function() {                              // NEW
                    tooltip.style('display', 'none');                           // NEW
                  });                                                           // NEW
 
                path.on('mousemove', function(d) {                            // NEW
                    tooltip.style('top', (d3.event.pageY -150) + 'px')          // NEW
                      .style('left', (d3.event.pageX + 50) + 'px');             // NEW
                  });                         

                
                svg.append('text')
                  .attr('x', -55)
                  .attr('y', -85)
                  .text('Importance in life: Family');                                                          //ÄNDRA LABEL HÄR

                 var legend = svg.selectAll('.legend')                     
                  .data(color.domain())                                   
                  .enter()                                                
                  .append('g')                                            
                  .attr('class', 'legend')                                
                  .attr('transform', function(d, i) {                     
                    var height = legendRectSize + legendSpacing;          
                    var offset =  height * color.domain().length / 2;     
                    var horz = 6 * legendRectSize;                       
                    var vert = i * height - offset;                       
                    return 'translate(' + horz + ',' + vert + ')';        
                  });                                                     

                legend.append('rect')                                     
                  .attr('width', legendRectSize)                          
                  .attr('height', legendRectSize)                         
                  .style('fill', color)                                   
                  .style('stroke', color);                                

                legend.append('text')                                     
                  .attr('x', legendRectSize + legendSpacing)              
                  .attr('y', legendRectSize - legendSpacing)              
                  .text(function(d) { return d; });                       
                }
            });


               


            //Importance in life friends
                d3.csv(selected_wave + "/Importance_in_life_Friends.csv", function(d) {
                // strip out relevant fields
                var point = {};
                point.country = d.Country;
                point.very_important = +d["Very important"];
                point.rather_important = +d["Rather important"];
                point.not_very_important = +d["Not very important"];
                point.not_at_all_important = +d["Not at all important"];
                point.inapplicable = Number(d.Inapplicable);
                point.no_answer = d.NA;
                point.dont_know = d.DK;
                return point;
            }, function(error, data) {

                //Sorting out the data to only display the country selected
                var noCountry = [];
                //Sorting out the data to only display the country selected
                for (i=0; i<data.length; i++) {
                    if (data[i].country == selected_country) {
                        data = data[i];
                        noCountry = [];
                    }
                    else {
                        noCountry.push(data[i].country)
                    }
                        //d3.select("#barHappiness").html("Data not available")
                }
                
                if (noCountry.length == data.length) {
                    console.log('not available')
                    d3.select("#chartFriends").html("Data not available")
                }
                else {

                if (data.inapplicable == undefined) {
                    var dataset = [
                        {label: 'Very important', count: data.very_important},
                        {label: 'Rather Important', count: data.rather_important},
                        {label: 'Not very important', count: data.not_very_important},
                        {label: 'Not at all important', count: data.not_at_all_important},
                        {label: 'Dont know', count: data.dont_know},
                        {label: 'No answer', count: data.no_answer}

                    ];
                }
                else {
                    var dataset = [
                        {label: 'Very important', count: data.very_important},
                        {label: 'Rather Important', count: data.rather_important},
                        {label: 'Not very important', count: data.not_very_important},
                        {label: 'Not at all important', count: data.not_at_all_important},
                        {label: 'Inapplicable', count: data.inapplicable.toString()},
                        {label: 'Dont know', count: data.dont_know},
                        {label: 'No answer', count: data.no_answer}

                    ];
                }

                var width = 400;
                var height = 200;
                var radius = Math.min(width, height) / 2;
                var donutWidth = 50;
                var legendRectSize = 20;                                  
                var legendSpacing = 8;                                    

                var color = d3.scaleOrdinal()
                  .range(['#c2f0f0', '#99e6e6', '#5cd6d6', '#2eb8b8', '#248f8f', '#196666']);

                                                                                          //ANVÄND DENNA FLR ATT TA BORT D#:JS OBKEKT
                var svg = d3.select('#chartFriends')                                  //ÄNDRA CHART HÄR
                  .append('svg')
                  .attr('width', width)
                  .attr('height', height)
                  .append('g')
                  .attr('transform', 'translate(' + (width / 4) +
                    ',' + (height / 2) + ')');

                var arc = d3.arc()
                  .innerRadius(radius - donutWidth)
                  .outerRadius(radius);

                var pie = d3.pie()
                  .value(function(d) { return d.count; })
                  .sort(null);
                    
                var tooltip = d3.select('#chartFamily')
                .append('div')
                .attr('class', 'tooltip');


                tooltip.append('div')
                .attr('class', 'label');

                tooltip.append('div')
                .attr('class', 'count');

                var path = svg.selectAll('path')
                  .data(pie(dataset))
                  .enter()
                  .append('path')
                  .attr('d', arc)
                  .attr('fill', function(d) {
                    return color(d.data.label);
                  });
                    
                path.on('mouseover', function(d) {
                    tooltip.select('.count').html(d.data.count + '%');

                    tooltip.style('display', 'block');
                    tooltip.style('opacity',2);
                });
                
                path.on('mouseout', function() {                              // NEW
                    tooltip.style('display', 'none');                           // NEW
                  });                                                           // NEW
 
                path.on('mousemove', function(d) {                            // NEW
                    tooltip.style('top', (d3.event.pageY -150) + 'px')          // NEW
                      .style('left', (d3.event.pageX + 50) + 'px');             // NEW
                  }); 

                svg.append('text')
                  .attr('x', -55)
                  .attr('y', -85)
                  .text('Importance in life: Friends');                                          //ÄNDRA LABEL HÄR

                 var legend = svg.selectAll('.legend')                     
                  .data(color.domain())                                   
                  .enter()                                                
                  .append('g')                                            
                  .attr('class', 'legend')                                
                  .attr('transform', function(d, i) {                     
                    var height = legendRectSize + legendSpacing;          
                    var offset =  height * color.domain().length / 2;     
                    var horz = 6 * legendRectSize;                       
                    var vert = i * height - offset;                       
                    return 'translate(' + horz + ',' + vert + ')';        
                  });                                                     

                legend.append('rect')                                     
                  .attr('width', legendRectSize)                          
                  .attr('height', legendRectSize)                         
                  .style('fill', color)                                   
                  .style('stroke', color);                                

                legend.append('text')                                     
                  .attr('x', legendRectSize + legendSpacing)              
                  .attr('y', legendRectSize - legendSpacing)              
                  .text(function(d) { return d; });                       
                }
            });

                    //Importance in life friends
                d3.csv(selected_wave + "/Importance_in_life_Leisure_time.csv", function(d) {
                // strip out relevant fields
                var point = {};
                point.country = d.Country;
                point.very_important = +d["Very important"];
                point.rather_important = +d["Rather important"];
                point.not_very_important = +d["Not very important"];
                point.not_at_all_important = +d["Not at all important"];
                point.inapplicable = Number(d.Inapplicable);
                point.no_answer = d.NA;
                point.dont_know = d.DK;
                return point;
            }, function(error, data) {

                //Sorting out the data to only display the country selected
                var noCountry = [];
                //Sorting out the data to only display the country selected
                for (i=0; i<data.length; i++) {
                    if (data[i].country == selected_country) {
                        data = data[i];
                        noCountry = [];
                    }
                    else {
                        noCountry.push(data[i].country)
                    }
                        //d3.select("#barHappiness").html("Data not available")
                }
                
                if (noCountry.length == data.length) {
                    console.log('not available')
                    d3.select("#chartLeisureTime").html("Data not available")
                }
                else {

                if (data.inapplicable == undefined) {
                    var dataset = [
                        {label: 'Very important', count: data.very_important},
                        {label: 'Rather Important', count: data.rather_important},
                        {label: 'Not very important', count: data.not_very_important},
                        {label: 'Not at all important', count: data.not_at_all_important},
                        {label: 'Dont know', count: data.dont_know},
                        {label: 'No answer', count: data.no_answer}

                    ];
                }
                else {
                    var dataset = [
                        {label: 'Very important', count: data.very_important},
                        {label: 'Rather Important', count: data.rather_important},
                        {label: 'Not very important', count: data.not_very_important},
                        {label: 'Not at all important', count: data.not_at_all_important},
                        {label: 'Inapplicable', count: data.inapplicable.toString()},
                        {label: 'Dont know', count: data.dont_know},
                        {label: 'No answer', count: data.no_answer}

                    ];
                }
                var width = 400;
                var height = 200;
                var radius = Math.min(width, height) / 2;
                var donutWidth = 50;
                var legendRectSize = 20;                                  
                var legendSpacing = 8;                                    

                var color = d3.scaleOrdinal()
                  .range(['#c2f0f0', '#99e6e6', '#5cd6d6', '#2eb8b8', '#248f8f', '#196666']);

                                                                                          //ANVÄND DENNA FLR ATT TA BORT D#:JS OBKEKT
                var svg = d3.select('#chartLeisureTime')                                  //ÄNDRA CHART HÄR
                  .append('svg')
                  .attr('width', width)
                  .attr('height', height)
                  .append('g')
                  .attr('transform', 'translate(' + (width / 4) +
                    ',' + (height / 2) + ')');

                var arc = d3.arc()
                  .innerRadius(radius - donutWidth)
                  .outerRadius(radius);

                var pie = d3.pie()
                  .value(function(d) { return d.count; })
                  .sort(null);
                    
                var tooltip = d3.select('#chartFamily')
                .append('div')
                .attr('class', 'tooltip');


                tooltip.append('div')
                .attr('class', 'label');

                tooltip.append('div')
                .attr('class', 'count');

                var path = svg.selectAll('path')
                  .data(pie(dataset))
                  .enter()
                  .append('path')
                  .attr('d', arc)
                  .attr('fill', function(d) {
                    return color(d.data.label);
                  });
                    
                path.on('mouseover', function(d) {
                    tooltip.select('.count').html(d.data.count + '%');

                    tooltip.style('display', 'block');
                    tooltip.style('opacity',2);
                });
                
                path.on('mouseout', function() {                              // NEW
                    tooltip.style('display', 'none');                           // NEW
                  });                                                           // NEW
 
                path.on('mousemove', function(d) {                            // NEW
                    tooltip.style('top', (d3.event.pageY -150) + 'px')          // NEW
                      .style('left', (d3.event.pageX + 50) + 'px');             // NEW
                  }); 

                svg.append('text')
                  .attr('x', -55)
                  .attr('y', -85)
                  .text('Importance in life: Leisure time');                                          //ÄNDRA LABEL HÄR

                 var legend = svg.selectAll('.legend')                     
                  .data(color.domain())                                   
                  .enter()                                                
                  .append('g')                                            
                  .attr('class', 'legend')                                
                  .attr('transform', function(d, i) {                     
                    var height = legendRectSize + legendSpacing;          
                    var offset =  height * color.domain().length / 2;     
                    var horz = 6 * legendRectSize;                       
                    var vert = i * height - offset;                       
                    return 'translate(' + horz + ',' + vert + ')';        
                  });                                                     

                legend.append('rect')                                     
                  .attr('width', legendRectSize)                          
                  .attr('height', legendRectSize)                         
                  .style('fill', color)                                   
                  .style('stroke', color);                                

                legend.append('text')                                     
                  .attr('x', legendRectSize + legendSpacing)              
                  .attr('y', legendRectSize - legendSpacing)              
                  .text(function(d) { return d; });                       
                }
            });




                    //Importance in life friends
                d3.csv(selected_wave + "/Importance_in_life_Politics.csv", function(d) {
                // strip out relevant fields
                var point = {};
                point.country = d.Country;
                point.very_important = +d["Very important"];
                point.rather_important = +d["Rather important"];
                point.not_very_important = +d["Not very important"];
                point.not_at_all_important = +d["Not at all important"];
                point.inapplicable = Number(d.Inapplicable);
                point.no_answer = d.NA;
                point.dont_know = d.DK;
                return point;
            }, function(error, data) {

                //Sorting out the data to only display the country selected
                var noCountry = [];
                //Sorting out the data to only display the country selected
                for (i=0; i<data.length; i++) {
                    if (data[i].country == selected_country) {
                        data = data[i];
                        noCountry = [];
                    }
                    else {
                        noCountry.push(data[i].country)
                    }
                        //d3.select("#barHappiness").html("Data not available")
                }
                
                if (noCountry.length == data.length) {
                    console.log('not available')
                    d3.select("#chartPolitics").html("Data not available")
                }
                else {

                if (data.inapplicable == undefined) {
                    var dataset = [
                        {label: 'Very important', count: data.very_important},
                        {label: 'Rather Important', count: data.rather_important},
                        {label: 'Not very important', count: data.not_very_important},
                        {label: 'Not at all important', count: data.not_at_all_important},
                        {label: 'Dont know', count: data.dont_know},
                        {label: 'No answer', count: data.no_answer}

                    ];
                }
                else {
                    var dataset = [
                        {label: 'Very important', count: data.very_important},
                        {label: 'Rather Important', count: data.rather_important},
                        {label: 'Not very important', count: data.not_very_important},
                        {label: 'Not at all important', count: data.not_at_all_important},
                        {label: 'Inapplicable', count: data.inapplicable.toString()},
                        {label: 'Dont know', count: data.dont_know},
                        {label: 'No answer', count: data.no_answer}

                    ];
                }

                var width = 400;
                var height = 200;
                var radius = Math.min(width, height) / 2;
                var donutWidth = 50;
                var legendRectSize = 20;                                  
                var legendSpacing = 8;                                    

                var color = d3.scaleOrdinal()
                  .range(['#c2f0f0', '#99e6e6', '#5cd6d6', '#2eb8b8', '#248f8f', '#196666']);

                                                                                          //ANVÄND DENNA FLR ATT TA BORT D#:JS OBKEKT
                var svg = d3.select('#chartPolitics')                                  //ÄNDRA CHART HÄR
                  .append('svg')
                  .attr('width', width)
                  .attr('height', height)
                  .append('g')
                  .attr('transform', 'translate(' + (width / 4) +
                    ',' + (height / 2) + ')');

                var arc = d3.arc()
                  .innerRadius(radius - donutWidth)
                  .outerRadius(radius);

                var pie = d3.pie()
                  .value(function(d) { return d.count; })
                  .sort(null);
                    
                var tooltip = d3.select('#chartFamily')
                .append('div')
                .attr('class', 'tooltip');


                tooltip.append('div')
                .attr('class', 'label');

                tooltip.append('div')
                .attr('class', 'count');

                var path = svg.selectAll('path')
                  .data(pie(dataset))
                  .enter()
                  .append('path')
                  .attr('d', arc)
                  .attr('fill', function(d) {
                    return color(d.data.label);
                  });
                    
                path.on('mouseover', function(d) {
                    tooltip.select('.count').html(d.data.count + '%');

                    tooltip.style('display', 'block');
                    tooltip.style('opacity',2);
                });
                
                path.on('mouseout', function() {                              // NEW
                    tooltip.style('display', 'none');                           // NEW
                  });                                                           // NEW
 
                path.on('mousemove', function(d) {                            // NEW
                    tooltip.style('top', (d3.event.pageY - 150) + 'px')          // NEW
                      .style('left', (d3.event.pageX + 50) + 'px');             // NEW
                  }); 

                svg.append('text')
                  .attr('x', -55)
                  .attr('y', -85)
                  .text('Importance in life: Politics');                                          //ÄNDRA LABEL HÄR

                 var legend = svg.selectAll('.legend')                     
                  .data(color.domain())                                   
                  .enter()                                                
                  .append('g')                                            
                  .attr('class', 'legend')                                
                  .attr('transform', function(d, i) {                     
                    var height = legendRectSize + legendSpacing;          
                    var offset =  height * color.domain().length / 2;     
                    var horz = 6 * legendRectSize;                       
                    var vert = i * height - offset;                       
                    return 'translate(' + horz + ',' + vert + ')';        
                  });                                                     

                legend.append('rect')                                     
                  .attr('width', legendRectSize)                          
                  .attr('height', legendRectSize)                         
                  .style('fill', color)                                   
                  .style('stroke', color);                                

                legend.append('text')                                     
                  .attr('x', legendRectSize + legendSpacing)              
                  .attr('y', legendRectSize - legendSpacing)              
                  .text(function(d) { return d; });                       
                }
            });




                    //Importance in life friends
                d3.csv(selected_wave + "/Importance_in_life_Religion.csv", function(d) {
                // strip out relevant fields
                var point = {};
                point.country = d.Country;
                point.very_important = +d["Very important"];
                point.rather_important = +d["Rather important"];
                point.not_very_important = +d["Not very important"];
                point.not_at_all_important = +d["Not at all important"];
                point.inapplicable = Number(d.Inapplicable);
                point.no_answer = d.NA;
                point.dont_know = d.DK;
                return point;
            }, function(error, data) {

                //Sorting out the data to only display the country selected
var noCountry = [];
                //Sorting out the data to only display the country selected
                for (i=0; i<data.length; i++) {
                    if (data[i].country == selected_country) {
                        data = data[i];
                        noCountry = [];
                    }
                    else {
                        noCountry.push(data[i].country)
                    }
                        //d3.select("#barHappiness").html("Data not available")
                }
                
                if (noCountry.length == data.length) {
                    console.log('not available')
                    d3.select("#chartReligion").html("Data not available")
                }
                else {
                if (data.inapplicable == undefined) {
                    var dataset = [
                        {label: 'Very important', count: data.very_important},
                        {label: 'Rather Important', count: data.rather_important},
                        {label: 'Not very important', count: data.not_very_important},
                        {label: 'Not at all important', count: data.not_at_all_important},
                        {label: 'Dont know', count: data.dont_know},
                        {label: 'No answer', count: data.no_answer}

                    ];
                }
                else {
                    var dataset = [
                        {label: 'Very important', count: data.very_important},
                        {label: 'Rather Important', count: data.rather_important},
                        {label: 'Not very important', count: data.not_very_important},
                        {label: 'Not at all important', count: data.not_at_all_important},
                        {label: 'Inapplicable', count: data.inapplicable.toString()},
                        {label: 'Dont know', count: data.dont_know},
                        {label: 'No answer', count: data.no_answer}

                    ];
                }

                var width = 400;
                var height = 200;
                var radius = Math.min(width, height) / 2;
                var donutWidth = 50;
                var legendRectSize = 20;                                  
                var legendSpacing = 8;                                    

                var color = d3.scaleOrdinal()
                  .range(['#c2f0f0', '#99e6e6', '#5cd6d6', '#2eb8b8', '#248f8f', '#196666']);

                                                                                          //ANVÄND DENNA FLR ATT TA BORT D#:JS OBKEKT
                var svg = d3.select('#chartReligion')                                  //ÄNDRA CHART HÄR
                  .append('svg')
                  .attr('width', width)
                  .attr('height', height)
                  .append('g')
                  .attr('transform', 'translate(' + (width / 4) +
                    ',' + (height / 2) + ')');

                var arc = d3.arc()
                  .innerRadius(radius - donutWidth)
                  .outerRadius(radius);

                var pie = d3.pie()
                  .value(function(d) { return d.count; })
                  .sort(null);
                    
                var tooltip = d3.select('#chartFamily')
                .append('div')
                .attr('class', 'tooltip');


                tooltip.append('div')
                .attr('class', 'label');

                tooltip.append('div')
                .attr('class', 'count');

                var path = svg.selectAll('path')
                  .data(pie(dataset))
                  .enter()
                  .append('path')
                  .attr('d', arc)
                  .attr('fill', function(d) {
                    return color(d.data.label);
                  });
                    
                path.on('mouseover', function(d) {
                    tooltip.select('.count').html(d.data.count + '%');

                    tooltip.style('display', 'block');
                    tooltip.style('opacity',2);
                });
                
                path.on('mouseout', function() {                              // NEW
                    tooltip.style('display', 'none');                           // NEW
                  });                                                           // NEW
 
                path.on('mousemove', function(d) {                            // NEW
                    tooltip.style('top', (d3.event.pageY - 150) + 'px')          // NEW
                      .style('left', (d3.event.pageX + 50) + 'px');             // NEW
                  }); 

                svg.append('text')
                  .attr('x', -55)
                  .attr('y', -85)
                  .text('Importance in life: Religion');                                          //ÄNDRA LABEL HÄR

                 var legend = svg.selectAll('.legend')                     
                  .data(color.domain())                                   
                  .enter()                                                
                  .append('g')                                            
                  .attr('class', 'legend')                                
                  .attr('transform', function(d, i) {                     
                    var height = legendRectSize + legendSpacing;          
                    var offset =  height * color.domain().length / 2;     
                    var horz = 6 * legendRectSize;                       
                    var vert = i * height - offset;                       
                    return 'translate(' + horz + ',' + vert + ')';        
                  });                                                     

                legend.append('rect')                                     
                  .attr('width', legendRectSize)                          
                  .attr('height', legendRectSize)                         
                  .style('fill', color)                                   
                  .style('stroke', color);                                

                legend.append('text')                                     
                  .attr('x', legendRectSize + legendSpacing)              
                  .attr('y', legendRectSize - legendSpacing)              
                  .text(function(d) { return d; });                       
                }
            });



                    //Importance in life friends
                d3.csv(selected_wave + "/Importance_in_life_Work.csv", function(d) {
                // strip out relevant fields
                var point = {};
                point.country = d.Country;
                point.very_important = +d["Very important"];
                point.rather_important = +d["Rather important"];
                point.not_very_important = +d["Not very important"];
                point.not_at_all_important = +d["Not at all important"];
                point.inapplicable = Number(d.Inapplicable);
                point.no_answer = d.NA;
                point.dont_know = d.DK;
                return point;
            }, function(error, data) {

                //Sorting out the data to only display the country selected
                var noCountry = [];
                //Sorting out the data to only display the country selected
                for (i=0; i<data.length; i++) {
                    if (data[i].country == selected_country) {
                        data = data[i];
                        noCountry = [];
                    }
                    else {
                        noCountry.push(data[i].country)
                    }
                        //d3.select("#barHappiness").html("Data not available")
                }
                
                if (noCountry.length == data.length) {
                    console.log('not available')
                    d3.select("#chartWork").html("Data not available")
                }
                else {

                if (data.inapplicable == undefined) {
                    var dataset = [
                        {label: 'Very important', count: data.very_important},
                        {label: 'Rather Important', count: data.rather_important},
                        {label: 'Not very important', count: data.not_very_important},
                        {label: 'Not at all important', count: data.not_at_all_important},
                        {label: 'Dont know', count: data.dont_know},
                        {label: 'No answer', count: data.no_answer}

                    ];
                }
                else {
                    var dataset = [
                        {label: 'Very important', count: data.very_important},
                        {label: 'Rather Important', count: data.rather_important},
                        {label: 'Not very important', count: data.not_very_important},
                        {label: 'Not at all important', count: data.not_at_all_important},
                        {label: 'Inapplicable', count: data.inapplicable.toString()},
                        {label: 'Dont know', count: data.dont_know},
                        {label: 'No answer', count: data.no_answer}

                    ];
                }

                var width = 400;
                var height = 200;
                var radius = Math.min(width, height) / 2;
                var donutWidth = 50;
                var legendRectSize = 20;                                  
                var legendSpacing = 8;                                    

                var color = d3.scaleOrdinal()
                  .range(['#c2f0f0', '#99e6e6', '#5cd6d6', '#2eb8b8', '#248f8f', '#196666']);

                                                                                          //ANVÄND DENNA FLR ATT TA BORT D#:JS OBKEKT
                var svg = d3.select('#chartWork')                                  //ÄNDRA CHART HÄR
                  .append('svg')
                  .attr('width', width)
                  .attr('height', height)
                  .append('g')
                  .attr('transform', 'translate(' + (width / 4) +
                    ',' + (height / 2) + ')');

                var arc = d3.arc()
                  .innerRadius(radius - donutWidth)
                  .outerRadius(radius);

                var pie = d3.pie()
                  .value(function(d) { return d.count; })
                  .sort(null);
                    
                var tooltip = d3.select('#chartFamily')
                .append('div')
                .attr('class', 'tooltip');


                tooltip.append('div')
                .attr('class', 'label');

                tooltip.append('div')
                .attr('class', 'count');

                var path = svg.selectAll('path')
                  .data(pie(dataset))
                  .enter()
                  .append('path')
                  .attr('d', arc)
                  .attr('fill', function(d) {
                    return color(d.data.label);
                  });
                    
                path.on('mouseover', function(d) {
                    tooltip.select('.count').html(d.data.count + '%');

                    tooltip.style('display', 'block');
                    tooltip.style('opacity',2);
                });
                
                path.on('mouseout', function() {                              // NEW
                    tooltip.style('display', 'none');                           // NEW
                  });                                                           // NEW
 
                path.on('mousemove', function(d) {                            // NEW
                    tooltip.style('top', (d3.event.pageY - 150) + 'px')          // NEW
                      .style('left', (d3.event.pageX + 50) + 'px');             // NEW
                  }); 

                svg.append('text')
                  .attr('x', -55)
                  .attr('y', -85)
                  .text('Importance in life: Work');                                          //ÄNDRA LABEL HÄR

                 var legend = svg.selectAll('.legend')                     
                  .data(color.domain())                                   
                  .enter()                                                
                  .append('g')                                            
                  .attr('class', 'legend')                                
                  .attr('transform', function(d, i) {                     
                    var height = legendRectSize + legendSpacing;          
                    var offset =  height * color.domain().length / 2;     
                    var horz = 6 * legendRectSize;                       
                    var vert = i * height - offset;                       
                    return 'translate(' + horz + ',' + vert + ')';        
                  });                                                     

                legend.append('rect')                                     
                  .attr('width', legendRectSize)                          
                  .attr('height', legendRectSize)                         
                  .style('fill', color)                                   
                  .style('stroke', color);                                

                legend.append('text')                                     
                  .attr('x', legendRectSize + legendSpacing)              
                  .attr('y', legendRectSize - legendSpacing)              
                  .text(function(d) { return d; });                       
                }
            });
        }
        
    </script>    
</body>
